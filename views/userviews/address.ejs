<%-include('./header')%>
<%-include('./sidebar')%>
<style>
    .address-box {
        border: 1px solid #ddd;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
    }

    .address-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 10px;
    }

    .edit-btn,
    .delete-btn {
        padding: 5px 10px;
        cursor: pointer;
        color: #000;
    }

    .edit-btn:hover,
    .delete-btn:hover {
        background-color: #ddd;
    }
</style>
<div class="col-md-5 border-right" style="margin-top: 80px;">
    <div class="p-3 py-5">
        <form id="editProfileForm">
            <div class="mt-3">
                <button class="btn btn-primary profile-button" id="openAddressModal" type="button">
                    <i class="fas fa-plus"></i> Add Address
                </button>
                <div id="addressContainer" style="border: 1px; padding: 10px;"></div>
            </div>
        </form>
    </div>
</div>

<div class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="addressModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addressModalLabel">Add Address</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addressForm">
                    <div class="form-group">
                        <label for="addressName">Name</label>
                        <input type="text" class="form-control" id="addressName" name="addressName" placeholder="" required="true">
                    </div>
                    <div class="form-group">
                        <label for="mobileNumber">Mobile Number</label>
                        <input type="text" class="form-control" id="mobileNumber" name="mobileNumber" placeholder="" required="true">
                    </div>
                    <div class="form-group">
                        <label for="buildingname">Building name</label>
                        <input type="text" class="form-control" id="buildingname" name="buildingname" placeholder="" required="true">
                    </div>
                    <div class="form-group">
                        <label for="street">Street</label>
                        <input type="text" class="form-control" id="street" name="street" placeholder="" required="true">
                    </div>
                    <div class="form-group">
                        <label for="city">City</label>
                        <input type="text" class="form-control" id="city" name="city" placeholder="" required="true">
                    </div>
                    <div class="form-group">
                        <label for="state">State</label>
                        <input type="text" class="form-control" id="state" name="state" placeholder="" required="true">
                    </div>
                    <div class="form-group">
                        <label for="PIN Code">PIN Code</label>
                        <input type="text" class="form-control" id="PIN Code" name="PIN Code" placeholder="" required="true">
                    </div>

                    <div class="form-group">
                        <label>Address Type</label><br>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="addressType" id="homeAddress" value="home">
                            <label class="form-check-label" for="homeAddress">Home</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="addressType" id="workAddress" value="work">
                            <label class="form-check-label" for="workAddress">Work</label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Save Address</button>

                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editAddressModal" tabindex="-1" role="dialog" aria-labelledby="editAddressModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <form id="editAddressForm">
                    <div class="form-group">
                        <label for="addressName">Name</label>
                        <input type="text" class="form-control" id="editaddressName" name="addressName" placeholder="" >
                    </div>
                    <div class="form-group">
                        <label for="mobileNumber">Mobile Number</label>
                        <input type="text" class="form-control" id="editmobileNumber" name="mobileNumber" placeholder="" >
                    </div>
                    <div class="form-group">
                        <label for="buildingname">Building name</label>
                        <input type="text" class="form-control" id="editbuildingname" name="buildingname" placeholder="" >
                    </div>
                    <div class="form-group">
                        <label for="street">Street</label>
                        <input type="text" class="form-control" id="editstreet" name="street" placeholder="" >
                    </div>
                    <div class="form-group">
                        <label for="city">City</label>
                        <input type="text" class="form-control" id="editcity" name="city" placeholder="" >
                    </div>
                    <div class="form-group">
                        <label for="state">State</label>
                        <input type="text" class="form-control" id="editstate" name="state" placeholder="" >
                    </div>
                    <div class="form-group">
                        <label for="PIN Code">PIN Code</label>
                        <input type="text" class="form-control" id="editPINCode" name="PINCode" placeholder="" >
                    </div>

                    <div class="form-group">
                        <label>Address Type</label><br>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="addressType" id="edithomeAddress" value="home">
                            <label class="form-check-label" for="homeAddress">Home</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="addressType" id="editworkAddress" value="work">
                            <label class="form-check-label" for="workAddress">Work</label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Save Address</button>
              
                </form>
                
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.4.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.getElementById('openAddressModal').addEventListener('click', function () {
        $('#addressModal').modal('show');
    });

    document.getElementById('addressForm').addEventListener('submit', function (event) {
        event.preventDefault();

        const addressData = {
            name: document.getElementById('addressName').value,
            mobile: document.getElementById('mobileNumber').value,
            buildingname: document.getElementById('buildingname').value,
            street: document.getElementById('street').value,
            city: document.getElementById('city').value,
            state: document.getElementById('state').value,
            pincode: document.getElementById('PIN Code').value,
            addresstype: document.querySelector('input[name="addressType"]:checked').value
        };

        fetch('/saveAddress', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(addressData),
        })
        .then(response => response.json())
        .then(data => {
            console.log('Address saved:', data);

            document.getElementById('addressForm').reset();

           
            $('#addressModal').modal('hide');
        })
        .catch(error => console.error('Error saving address:', error));
        window.location.reload()
    });

    window.addEventListener('load', () => {
    fetch('/getAddresses')
            .then(response => response.json())
            .then(addresses => {

                addresses.forEach(address => {
                    const addressElement = document.createElement('div');
                    addressElement.className = 'address-box';
                    addressElement.innerHTML = `
                      ${address.name},
                      ${address.mobile},
                      ${address.buildingname},
                      ${address.street},
                      ${address.city},
                      ${address.state},
                      ${address.pincode},
                      ${address.addresstype}
                        
                    `;
                
    const addressActions = document.createElement('div');
    addressActions.className = 'address-actions';

    
    const editButton = document.createElement('i');
    editButton.className = 'fas fa-edit edit-btn';
    
    $(document).ready(function() {
    
    $('.edit-btn').click(function() {
       
        $('#editAddressModal').modal('show');
    });
});

    const deleteButton = document.createElement('i');
    deleteButton.className = 'fas fa-trash delete-btn';
    deleteButton.addEventListener('click', () => {
    console.log('Deleting address with ID:', address._id); 
    handleDeleteAddress(address._id);
});

    addressActions.appendChild(editButton);
    addressActions.appendChild(deleteButton);

    addressElement.appendChild(addressActions);

                    document.getElementById('addressContainer').appendChild(addressElement);
                });
            })
            .catch(error => console.error('Error loading addresses:', error));
    });
    

    function handleDeleteAddress(addressId) {
        fetch(`/deleteAddress/${addressId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        console.log('Address deleted:', data);
    })
    .catch(error => console.error('Error deleting address:', error));
    window.location.reload();
}


function handleEditAddress(addressId) {
    fetch(`/getaddresses/${addressId}`)
    console.log(address)
        .then(response => response.json())
        .then(address => {
            
            document.getElementById('editaddressName').value = address.name;
            document.getElementById('editmobileNumber').value = address.mobile;
            document.getElementById('editbuildingname').value = address.buildingname;
            document.getElementById('editstreet').value = address.street;
            document.getElementById('editcity').value = address.city;
            document.getElementById('editstate').value = address.state;
            document.getElementById('editPINCode').value = address.pincode;

           
            if (address.addresstype === 'home') {
                document.getElementById('edithomeAddress').checked = true;
            } else if (address.addresstype === 'work') {
                document.getElementById('editworkAddress').checked = true;
            }

            $('#editAddressModal').modal('show');
        })
        .catch(error => console.error('Error fetching address data:', error));
}

document.getElementById('editAddressForm').addEventListener('submit', function (event) {
    event.preventDefault();

    const addressId = this.getAttribute('data-current-address-id');
    
    const updatedAddressData = {
        name: document.getElementById('editaddressName').value,
        mobile: document.getElementById('editmobileNumber').value,
        buildingname: document.getElementById('editbuildingname').value,
        street: document.getElementById('editstreet').value,
        city: document.getElementById('editcity').value,
        state: document.getElementById('editstate').value,
        pincode: document.getElementById('editPINCode').value,
        addresstype: document.querySelector('input[name="addressType"]:checked').value
    };

    fetch(`/updateAddress/${addressId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(updatedAddressData),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Address updated:', data);

        $('#editAddressModal').modal('hide');
    })
    .catch(error => console.error('Error updating address:', error));
});
 </script>

<%-include('./footer')%>
