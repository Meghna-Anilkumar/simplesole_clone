<%-include('./sidebar')%>

<div class="content">
  <h2 style="color: blue;">Customers</h2>
  
<!-- Search Form -->
<form method="get" action="/customers" class="mb-4">
  <div class="input-group input-group-sm">
    <input type="text" name="search" 
           class="form-control form-control-sm" 
           style="max-width: 250px;" 
           placeholder="Search by name or email" 
           value="<%= typeof search !== 'undefined' ? search : '' %>">
    <button type="submit" class="btn btn-primary btn-sm">Search</button>
  </div>
</form>


  <% if(message) { %>
    <div class="alert alert-dismissable fade show alert-<%=message.type %>" role="alert">
      <button class="btn-close" type="button" data-bs-dismiss="alert" aria-label="Close"></button>
      <strong><%= message.message %></strong>
    </div>
  <% } %>

  <% if (users.length > 0) { %>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Index</th>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% users.forEach((row, index) => { %>
          <tr>
            <td><%= index + 1 + (page - 1) * limit %></td>
            <td><%= row.userId %></td>
            <td><%= row.name %></td>
            <td><%= row.email %></td>
            <td>
              <form method="post" action="/block-user">
                <input type="hidden" name="userId" value="<%= row._id %>">
                <% if (row.blocked) { %>
                  <button type="submit" class="btn btn-success">Unblock</button>
                <% } else { %>
                  <button type="submit" class="btn btn-danger">Block</button>
                <% } %>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>

    <!-- Pagination -->
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <% if (page > 1) { %>
          <li class="page-item">
            <a class="page-link" href="?page=<%= page - 1 %>&limit=<%= limit %>&search=<%= search || '' %>">Previous</a>
          </li>
        <% } %>
        
        <% for(let i = 1; i <= totalPages; i++) { %>
          <li class="page-item <%= page == i ? 'active' : '' %>">
            <a class="page-link" href="?page=<%= i %>&limit=<%= limit %>&search=<%= search || '' %>"><%= i %></a>
          </li>
        <% } %>
        
        <% if (page < totalPages) { %>
          <li class="page-item">
            <a class="page-link" href="?page=<%= page + 1 %>&limit=<%= limit %>&search=<%= search || '' %>">Next</a>
          </li>
        <% } %>
      </ul>
    </nav>
  <% } else { %>
    <h1 class="text-center text-secondary mt-5">No users found</h1>
  <% } %>
</div>
</body>
</html>